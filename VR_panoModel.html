<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>全景结合模型</title>
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
        body {
            background:#777;
            padding:0;
            margin:0;
            font-weight: bold;
            overflow:hidden;
        }

        #info {
            position: absolute;
            top: 0px; width: 100%;
            color: #ffffff;
            padding: 5px;
            font-family:Monospace;
            font-size:13px;
            text-align:center;
            z-index:1000;
        }
        a {
            color: #ffffff;
        }
        #oldie a { color:#da0 }
    </style>
</head>
<body>
<script src="js/three/three.js"></script>
<script src="js/three/StereoEffect.js"></script>
<script src="js/three/Detector.js"></script>
<script src="js/three/OBJMTLLoader.js"></script>
<script src="js/three/OBJLoader0k.js"></script>
<script src="js/three/MTLLoader.js"></script>
<script>
    if ( ! Detector.webgl ) Detector.addGetWebGLMessage();

    var container;

    var camera, scene, renderer, effect;

    var mesh, lightMesh, geometry;

    var directionalLight, pointLight;

    var mouseX = 0, mouseY = 0;

    var windowHalfX = window.innerWidth / 2;
    var windowHalfY = window.innerHeight / 2;

    document.addEventListener( 'mousemove', onDocumentMouseMove, false );

    init();
    animate();

    function init() {

        container = document.createElement( 'div' ); //创建容器
        document.body.appendChild( container );

        camera = new THREE.PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 1, 100000 );//创建透视相机，最常见的相机
        camera.position.z = 3200;

        scene = new THREE.Scene();
        scene.background = new THREE.CubeTextureLoader()//创建场景的背景；
            .setPath( 'obj/Park3Med/' )//设置路径
            .load( [ 'px.jpg', 'nx.jpg', 'py.jpg', 'ny.jpg', 'pz.jpg', 'nz.jpg' ] );

        // var geometry = new THREE.SphereBufferGeometry( 100, 32, 16 );

        var textureCube = new THREE.CubeTextureLoader()
            .setPath( 'obj/Park3Med/' )
            .load( [ 'px.jpg', 'nx.jpg', 'py.jpg', 'ny.jpg', 'pz.jpg', 'nz.jpg' ] );
        textureCube.mapping = THREE.CubeRefractionMapping;//折射

        var material = new THREE.MeshBasicMaterial( { color: 0xffffff, envMap: textureCube, refractionRatio: 0.95 } ); //envMap立方体环境映射；
        // var  material=new THREE.MeshLambertMaterial({color:0xe0e0e0,opacity:0.1});

        var mesh = new THREE.Mesh( geometry, material );

        var loader1=new THREE.OBJLoader();
        loader1.load("obj/building 11.obj",function(ssobject){
            ssobject.scale.set(0.1,0.1,0.1);
            //ssobject.rotation.x=-Math.PI;
            //ssobject.rotation.z=Math.PI/4;
            //ssobject.position.z=10;
            ssobject.position.x=30;
            ssobject.position.y=22;
            scene.add(ssobject);
        })

        var mtlLoader = new THREE.MTLLoader();//mtl材质加载器
        mtlLoader.load( 'obj/building 11.mtl', mtl);//加载.mtl文件，执行mtl函数

        function mtl( material ) {
            var objLoader = new THREE.OBJLoader();//obj模型加载器
            objLoader.setMaterials( material );//mtl材质赋值给obj模型
            objLoader.load( 'obj/building 11.obj',obj );//加载.obj文件，执行obj函数
        }

        function obj( object3D ) {
            object3D.scale.set(20,20,20);//放大object3D对象
            object3D.position.x=10;
            object3D.position.y=1;
            object3D.position.z=-50;
            object3D.rotateX(2*Math.PI);
            //旋转
            scene.add( object3D );//object3D对象插入场景对象
        }
        var light=new THREE.PointLight(0xCCCCCC);
        light.position.set(3000,4000,2000);
        scene.add(light);
        scene.add(new THREE.AmbientLight(0xffffff));//环境光


        mesh.position.x = 500;
        mesh.position.y = 500;
        mesh.position.z = 500;

        mesh.scale.x = mesh.scale.y = mesh.scale.z = 3;
        scene.add( mesh );

        //
        renderer = new THREE.WebGLRenderer();
        renderer.setPixelRatio( window.devicePixelRatio );
        container.appendChild( renderer.domElement );

        effect = new THREE.StereoEffect( renderer );
        effect.setSize( window.innerWidth, window.innerHeight );

        window.addEventListener( 'resize', onWindowResize, false );

    }

    function onWindowResize() {

        windowHalfX = window.innerWidth / 2;
        windowHalfY = window.innerHeight / 2;

        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();

        effect.setSize( window.innerWidth, window.innerHeight );

    }

    function onDocumentMouseMove( event ) {
        mouseX = ( event.clientX - windowHalfX ) * 10;
        mouseY = ( event.clientY - windowHalfY ) * 10;
    }
    function animate() {
        requestAnimationFrame( animate );
        render();
    }

    function render() {

        var timer = 0.0001 * Date.now();
        camera.position.x += ( mouseX - camera.position.x ) * .05;
        camera.position.y += ( - mouseY - camera.position.y ) * .05;
        camera.lookAt( scene.position );

        effect.render( scene, camera );

        // lat = Math.max( - 85, Math.min( 85, lat ) );
        // phi = THREE.Math.degToRad( 90 - lat );
        // theta = THREE.Math.degToRad( lon );
        // camera.target.x = 500 * Math.sin( phi ) * Math.cos( theta );
        // camera.target.y = 500 * Math.cos( phi );
        // camera.target.z = 500 * Math.sin( phi ) * Math.sin( theta );
        // camera.lookAt( camera.target );
        // renderer.render( scene, camera );

    }
</script>
</body>
</html>